# SvelteKit + TypeScript Development Guide

## Svelte 5 Standards (New)

### Syntax & Runes
- **State**: Use `$state(initialValue)` instead of `let variable = initialValue`.
- **Props**: Use `let { prop1, prop2 } = $props<{ prop1: string; prop2?: number }>()` instead of `export let prop1`.
- **Derived State**: Use `$derived(expression)` instead of `$: variable = expression`.
- **Side Effects**: Use `$effect(() => { ... })` instead of `$: { ... }` for side effects.
- **Bindings**: Use `$bindable()` in props for two-way binding.

### Event Handling
- **Callback Props**: Use callback props (e.g., `onConfirm`, `onChange`) instead of `createEventDispatcher`.
- **Naming**: Prefix event callback props with `on` (e.g., `onSave`, `onCancel`).
- **Usage**: Call the function directly: `onSave?.(data)`.

### Theme Management
- **Global Store**: Use the global theme store: `import { theme } from '$lib/stores/theme.svelte.js'`.
- **Access**: Use `theme.current` to get the current theme.
- **Update**: Use `theme.setTheme('light' | 'dark' | 'system')` to change the theme.
- **No Local Logic**: Do not implement local theme state or logic in individual components.

### Localization (i18n)
- **Library**: Use Paraglide JS.
- **Import**: `import * as m from '$lib/paraglide/messages.js'`.
- **Usage**: Call message functions: `m.hello_world()`.
- **Parameters**: Pass parameters as an object: `m.welcome_user({ name: 'Bobby' })`.

### Modals & Async Actions
- **Loading State**: Always implement an `isLoading` prop for modals performing async actions.
- **Button State**: Disable buttons and show a spinner/loading icon when `isLoading` is true.
- **Destructuring**: Destructure props with default values in the `$props()` definition.

## Type Imports
- Use `ServerLoad` instead of `PageServerLoad`.
- Use `Actions` instead of `PageActions`.
- Do not import `HandleError`; define the function type directly.
- Use `typeof table.session.$inferInsert` instead of `table.Session`.

## API vs Server Actions
- **API Endpoints**: Use `error()` to throw errors, return `json()` for success.
    - Example: `throw error(401, { message: 'Unauthorized' })`
- **Server Actions**: Use `fail()` to return errors, return plain objects for success.
    - Example: `return fail(401, { message: 'Unauthorized' })`

## Null Checks
- Always check if `locals.user` is null/undefined.
- Pattern: `if (!locals.user) { throw error(401, { message: 'Unauthorized' }); }`

## Function Parameter Types
- Avoid implicit `any` types.
- Explicitly specify parameter types: `({ error, event }: { error: unknown; event: any })`.

## Import Statements
- Ensure all used functions are imported: `import { error, fail, redirect } from '@sveltejs/kit'`.

## Component Attributes
- Avoid using non-existent component attributes (e.g., `onchange` on elements that don't support it, unless it's a custom prop).
- Use correct event handling syntax.

## Type References
- Avoid recursive type references.
- Use specific types instead of generics where possible.

## Language Types
- Use union types instead of strings: `"en" | "zh-cn"`.
- Avoid dynamic string index types for language keys.
